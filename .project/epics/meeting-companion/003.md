---
name: Create Obsidian file writer
status: closed
created: 2026-01-22T21:05:26Z
updated: 2026-01-28T18:07:45Z
github: pending-sync
depends_on: [002]
parallel: false
conflicts_with: [002]
reopened: true
reopen_reason: Extended scope - save markdown to recording folder, add summary support
---

# Task: Create Obsidian file writer

## Description

Create functionality to save meeting transcripts and summaries to markdown files.

**Phase 1 (NEW):** Save transcript/summary markdown to the same folder as the audio recording.
**Phase 2:** Merge transcript data back into the original Obsidian meeting prep file.

## Acceptance Criteria

### Phase 1: Save to Recording Folder
- [x] Auto-generate markdown file when recording stops
- [x] Save to same folder as audio recording (e.g., `meetily-recordings/`)
- [x] Filename matches recording (e.g., `meeting-2026-01-28.md`)
- [x] Include transcript in `## Transcript` section
- [ ] Include summary in `## Summary` section (when user clicks Save) **IN PROGRESS**
- [x] Include meeting metadata in frontmatter (date, duration, etc.)

### Phase 2: Update Meeting Prep File (existing)
- [x] `obsidian/writer.rs` created with merge logic
- [x] Transcript appended to `## Transcript` section
- [x] Existing file content preserved exactly
- [x] Frontmatter `status` updated to "completed"
- [x] Atomic file writes (write to temp, then rename)
- [x] Tauri command `save_meeting_transcript(path, transcript)` works
- [x] Speaker labels formatted as `**Speaker X:**`
- [x] Timestamps formatted as `[HH:MM:SS]`

## Technical Details

### Phase 1: Save to Recording Folder

#### Output Location
```
C:\Users\{user}\Music\meetily-recordings\
├── meeting-2026-01-28_10-30-00.mp4      # Audio/video recording
├── meeting-2026-01-28_10-30-00.md       # NEW: Transcript + summary markdown
```

#### Markdown Output Format
```markdown
---
date: 2026-01-28
time_start: 10:30:00
duration: 45:12
recording: meeting-2026-01-28_10-30-00.mp4
status: completed
---

# Meeting Notes - 2026-01-28

## Summary

[AI-generated summary here]

### Key Points
- Point 1
- Point 2

### Action Items
- [ ] Action item 1
- [ ] Action item 2

## Transcript

[00:00:12] **Speaker 1:** Welcome everyone to the meeting.

[00:00:34] **Speaker 2:** Thanks for having us.
```

#### Implementation

1. **Hook into recording stop event** - When recording completes
2. **Gather data**:
   - Recording path/filename
   - Transcript segments from TranscriptContext
   - Summary from summary_processes table (if available)
3. **Generate markdown** using existing `format_transcript_section()`
4. **Save file** alongside recording with matching base name

#### New Function
```rust
pub async fn save_meeting_markdown(
    recording_path: &Path,
    segments: &[TranscriptSegment],
    summary: Option<&SummaryResult>,
) -> Result<PathBuf, WriteError> {
    let md_path = recording_path.with_extension("md");
    let content = generate_meeting_markdown(segments, summary);
    atomic_write(&md_path, &content).await?;
    Ok(md_path)
}
```

### Phase 2: Update Meeting Prep File (existing implementation)

Files already created:
```
frontend/src-tauri/src/obsidian/
├── writer.rs        # Merge + atomic save (exists)
└── mod.rs           # Exports (exists)
```

## Dependencies

- [x] Task 002 (Obsidian parser) - need `MeetingPrep` struct and parsing logic
- [x] Recording path available at stop time
- [x] Summary data accessible from database (via Tauri command)

## Effort Estimate

- Size: M (expanded from S)
- Hours: 5 (2 for Phase 1, 3 already done for Phase 2)
- Parallel: false

## Definition of Done

### Phase 1
- [x] Markdown file auto-generated when recording stops
- [x] File saved to same folder as recording
- [x] Transcript included and formatted correctly
- [x] Summary included when available (via `update_meeting_summary` Tauri command)
- [x] Frontmatter contains useful metadata

### Phase 2 (already done)
- [x] `obsidian/writer.rs` compiles without errors
- [x] Unit test for transcript formatting
- [x] Unit test for frontmatter status update
- [x] Unit test for atomic write
- [x] Manual test: save transcript to real file
- [x] Original content preserved exactly
- [x] Code reviewed

## Progress Notes (2026-01-28)

### Summary Save to Markdown - WIP

**Problem identified:** When user clicks "Save" on a summary, it only saved to SQLite database (`api_save_meeting_summary`), not to the markdown file in the recordings folder.

**Changes made:**
1. Updated `frontend/src/hooks/meeting-details/useMeetingData.ts`:
   - `handleSaveSummary` now calls BOTH:
     - `api_save_meeting_summary` (SQLite) - existing
     - `update_meeting_summary` (markdown file) - NEW
   - Constructs markdown path from `meeting.folder_path` and folder name
   - Path format: `{folder_path}/{folderName}.md`

**Backend already exists:**
- `update_meeting_summary` Tauri command in `obsidian/mod.rs`
- `update_meeting_markdown_with_summary` in `obsidian/writer.rs`
- Inserts/replaces `## Summary` section in existing markdown

**Still needs testing:**
- [ ] Verify `meeting.folder_path` is populated correctly
- [ ] Verify markdown file path construction works on Windows
- [ ] End-to-end test: record → generate summary → save → check .md file
